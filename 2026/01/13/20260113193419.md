# Commit: a91e6500de8624f03eb984a4b122b11e1fefc28a
## Message: GP-6294: Fix P-code Stepper: Trace doesn't store uniques.
## Diff:
```
diff --git a/Ghidra/Debug/Framework-TraceModeling/src/main/java/ghidra/pcode/exec/trace/TraceEmulationIntegration.java b/Ghidra/Debug/Framework-TraceModeling/src/main/java/ghidra/pcode/exec/trace/TraceEmulationIntegration.java
index 4fc58d32bd6..b0c4d1917aa 100644
--- a/Ghidra/Debug/Framework-TraceModeling/src/main/java/ghidra/pcode/exec/trace/TraceEmulationIntegration.java
+++ b/Ghidra/Debug/Framework-TraceModeling/src/main/java/ghidra/pcode/exec/trace/TraceEmulationIntegration.java
@@ -795,6 +795,9 @@ public <B, U> AddressSetView readUninitialized(PcodeThread<Object> thread,
 				return set;
 			}
 			AddressSpace space = set.getMinAddress().getAddressSpace();
+			if (space.isUniqueSpace()) {
+				return set;
+			}
 			PcodeTraceDataAccess acc = space.isRegisterSpace() ? getRegAccess(thread) : memAccess;
 			return handlerFor(piece).readUninitialized(acc, thread, piece, set);
 		}
diff --git a/Ghidra/Debug/Framework-TraceModeling/src/main/java/ghidra/trace/database/time/DBTraceTimeManager.java b/Ghidra/Debug/Framework-TraceModeling/src/main/java/ghidra/trace/database/time/DBTraceTimeManager.java
index c5aa671421b..6588ea8e384 100644
--- a/Ghidra/Debug/Framework-TraceModeling/src/main/java/ghidra/trace/database/time/DBTraceTimeManager.java
+++ b/Ghidra/Debug/Framework-TraceModeling/src/main/java/ghidra/trace/database/time/DBTraceTimeManager.java
@@ -235,13 +235,14 @@ protected DBTraceSnapshot doFindNearest(TraceSchedule schedule, long version) {
 	@Override
 	public TraceSnapshot findSnapshotWithNearestPrefix(TraceSchedule schedule) {
 		long version = trace.getEmulatorCacheVersion();
-		Optional<? extends TraceSnapshot> exists = getSnapshotsWithSchedule(schedule).stream()
+		TraceSchedule noPSteps = schedule.dropPSteps();
+		Optional<? extends TraceSnapshot> exists = getSnapshotsWithSchedule(noPSteps).stream()
 				.filter(s -> s.getVersion() >= version)
 				.findFirst();
 		if (exists.isPresent()) {
 			return exists.get();
 		}
-		return doFindNearest(schedule.dropPSteps(), version);
+		return doFindNearest(noPSteps, version);
 	}
 
 	@Override
```
-----------------------------------
