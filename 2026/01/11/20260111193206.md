# Commit: 34143b6599d97e5956d816af67e695d8dd9ccc5f
## Message: Merge branch 'GP-6288_ryanmkurtz_pyghidra' (#8529)
## Diff:
```
diff --git a/Ghidra/Features/PyGhidra/src/main/py/src/pyghidra/internal/plugin/plugin.py b/Ghidra/Features/PyGhidra/src/main/py/src/pyghidra/internal/plugin/plugin.py
index b7629e021e8..b19cc0f06d0 100644
--- a/Ghidra/Features/PyGhidra/src/main/py/src/pyghidra/internal/plugin/plugin.py
+++ b/Ghidra/Features/PyGhidra/src/main/py/src/pyghidra/internal/plugin/plugin.py
@@ -30,6 +30,7 @@
 from ghidra.pyghidra.interpreter import PyGhidraConsole
 from ghidra.util.task import TaskMonitor
 from java.io import BufferedReader, InputStreamReader # type:ignore @UnresolvedImport
+from java.lang import Boolean # type:ignore @UnresolvedImport
 from java.lang import String # type:ignore @UnresolvedImport 
 from java.lang import Thread as JThread # type:ignore @UnresolvedImport
 from java.util import Collections # type:ignore @UnresolvedImport
@@ -171,6 +172,7 @@ def __init__(self, py_plugin: PyGhidraPlugin):
         self._script.set(state, ScriptControls(console, TaskMonitor.DUMMY))
         self._state = ConsoleState.RESET
         self._completer = PythonCodeCompleter(self)
+        self._orig_modules = sys.modules.copy()
 
     def raw_input(self, prompt=''):
         self._console.setPrompt(prompt)
@@ -238,6 +240,11 @@ def reset(self):
 
         # this resets the locals, and gets a new code compiler
         super().__init__(locals=PyGhidraScript(self._script))
+        
+        # restore sys.modules to its original state
+        if not Boolean.getBoolean("pyghidra.sys.modules.restore.disable"):
+            for k in list(set(sys.modules) - set(self._orig_modules)):
+                sys.modules.pop(k, None)
     
     @property
     def name(self) -> str:
diff --git a/Ghidra/Features/PyGhidra/src/main/py/src/pyghidra/script.py b/Ghidra/Features/PyGhidra/src/main/py/src/pyghidra/script.py
index e272620277f..200e4fdb4bc 100644
--- a/Ghidra/Features/PyGhidra/src/main/py/src/pyghidra/script.py
+++ b/Ghidra/Features/PyGhidra/src/main/py/src/pyghidra/script.py
@@ -270,7 +270,7 @@ def run(self, script_path: str = None, script_args: List[str] = None):
         finally:
             sys.argv = orig_argv
 
-            if Boolean.getBoolean("pyghidra.sys.modules.restore"):
+            if not Boolean.getBoolean("pyghidra.sys.modules.restore.disable"):
                 for k in list(set(sys.modules) - set(orig_modules)):
                     sys.modules.pop(k, None)
 
diff --git a/Ghidra/RuntimeScripts/Common/support/launch.properties b/Ghidra/RuntimeScripts/Common/support/launch.properties
index aaf0472b08a..47d8b5d5291 100644
--- a/Ghidra/RuntimeScripts/Common/support/launch.properties
+++ b/Ghidra/RuntimeScripts/Common/support/launch.properties
@@ -159,7 +159,6 @@ VMARGS=--enable-native-access=ALL-UNNAMED
 # Disables the loaders echoing their message log to the application.log file
 #VMARGS=-Ddisable.loader.logging=true
 
-# Restores sys.modules to its prior state after a PyGhidra script is run so the next time the script
-# is run, it freshly reloads all of its imported modules again. This is experimental and should only
-# be enabled if necessary.
-#VMARGS=-Dpyghidra.sys.modules.restore=true
+# Prevents PyGhidra from restoring sys.modules to its original state after a PyGhidra script is run.
+# Used to help debug potential issues that might arise from mucking with sys.modules.
+#VMARGS=-Dpyghidra.sys.modules.restore.disable=true
```
-----------------------------------
