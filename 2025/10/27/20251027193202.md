# Commit: 71750626bfd0e57100b3c24a0c6ffd8365457aab
## Message: GP-6069 - Fixed keyboard focus issue when showing a modal dialog over a modal dialog
## Diff:
```
diff --git a/Ghidra/Framework/Docking/src/main/java/docking/DockingDialog.java b/Ghidra/Framework/Docking/src/main/java/docking/DockingDialog.java
index e565b257b1f..c503320bc1d 100644
--- a/Ghidra/Framework/Docking/src/main/java/docking/DockingDialog.java
+++ b/Ghidra/Framework/Docking/src/main/java/docking/DockingDialog.java
@@ -27,6 +27,7 @@
 import docking.framework.ApplicationInformationDisplayFactory;
 import generic.util.WindowUtilities;
 import ghidra.framework.Application;
+import ghidra.util.Swing;
 import ghidra.util.bean.GGlassPane;
 import help.HelpDescriptor;
 
@@ -45,13 +46,17 @@ public class DockingDialog extends JDialog implements HelpDescriptor {
 	private DialogComponentProvider component;
 	private boolean hasBeenFocused;
 	private Runnable requestFocusRunnable = () -> {
+		if (hasBeenFocused) {
+			return;
+		}
+
+		hasBeenFocused = true;
 		if (focusComponent != null) {
 			focusComponent.requestFocus();
-			hasBeenFocused = true;
 		}
+		WindowUtilities.bringModalestDialogToFront(DockingDialog.this);
 	};
 	private DockingWindowManager owningWindowManager;
-	private WindowAdapter modalFixWindowAdapter;
 
 	/**
 	 * Creates a default parent frame that will appear in the OS's task bar.  Having this frame
@@ -188,6 +193,14 @@ private String getKey() {
 		return component.getClass().getName() + System.identityHashCode(scopeObject);
 	}
 
+	private void requestInitialFocus() {
+		Component newFocusComponent = component.getFocusComponent();
+		if (newFocusComponent != null) {
+			focusComponent = newFocusComponent;
+			Swing.runLater(requestFocusRunnable);
+		}
+	}
+
 	private void init(DialogComponentProvider provider) {
 		component = provider;
 		provider.setDialog(this);
@@ -197,24 +210,21 @@ private void init(DialogComponentProvider provider) {
 		pack();
 		setResizable(provider.isResizeable());
 		windowAdapter = new WindowAdapter() {
-			@Override
-			public void windowActivated(WindowEvent e) {
-				if (!hasBeenFocused) {
-					Component newFocusComponent = component.getFocusComponent();
-					if (newFocusComponent != null) {
-						focusComponent = newFocusComponent;
-						SwingUtilities.invokeLater(requestFocusRunnable);
-					}
-				}
-			}
 
 			@Override
 			public void windowOpened(WindowEvent e) {
+
 				Tool tool = null;
 				if (owningWindowManager != null) {
 					tool = owningWindowManager.getTool();
 				}
 				component.dialogShown(tool);
+
+				// Note: this call was previously in windowActivated().  We found that method was 
+				// not called consistently on all platforms.  On Windows, when showing a modal 
+				// dialog over a modal dialog, the newest dialog would not get the windowActivated()
+				// callback.  windowOpened() seems to be called consistently.  
+				requestInitialFocus();
 			}
 
 			@Override
@@ -229,15 +239,8 @@ public void windowClosed(WindowEvent e) {
 				cleanup();
 			}
 		};
-		this.addWindowListener(windowAdapter);
-		modalFixWindowAdapter = new WindowAdapter() {
-			@Override
-			public void windowOpened(WindowEvent e) {
-				WindowUtilities.bringModalestDialogToFront(DockingDialog.this);
-			}
-		};
 
-		this.addWindowListener(modalFixWindowAdapter);
+		addWindowListener(windowAdapter);
 
 		if (provider.getDefaultButton() != null) {
 			getRootPane().setDefaultButton(provider.getDefaultButton());
```
-----------------------------------
