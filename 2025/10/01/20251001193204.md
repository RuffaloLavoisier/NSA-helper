# Commit: cae8caac1436d4c98bbd825e83c0fbecbda9a7da
## Message: GP-5526 Correct CreateThunkCmd NPE
## Diff:
```
diff --git a/Ghidra/Features/Base/src/main/java/ghidra/app/cmd/function/CreateThunkFunctionCmd.java b/Ghidra/Features/Base/src/main/java/ghidra/app/cmd/function/CreateThunkFunctionCmd.java
index 1743a23304e..52278eb741c 100644
--- a/Ghidra/Features/Base/src/main/java/ghidra/app/cmd/function/CreateThunkFunctionCmd.java
+++ b/Ghidra/Features/Base/src/main/java/ghidra/app/cmd/function/CreateThunkFunctionCmd.java
@@ -563,14 +563,15 @@ public static Address getThunkedAddr(Program program, Address entry,
 		Listing listing = program.getListing();
 
 		Instruction instr = listing.getInstructionAt(entry);
-		if (instr == null) {
-			return null;
-		}
+
 		// if there is no pcode, go to the next instruction
 		// assume fallthrough (ie. x86 instruction ENDBR64)
 		// TODO: at some point, might need to do a NOP detection
-		if (instr.getPcode().length == 0) {
-			instr = listing.getInstructionAfter(entry);
+		while (instr != null && instr.getPcode().length == 0) {
+			instr = listing.getInstructionAfter(instr.getAddress());
+		}
+		if (instr == null) {
+			return null;
 		}
 
 		FlowType flowType;
```
-----------------------------------
